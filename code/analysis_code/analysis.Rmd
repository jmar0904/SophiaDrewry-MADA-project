---
title: "Analysis"
author: "Sophia Drewry"
date: "10/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
load needed packages. make sure they are installed.

```{r}
library(readr)
library(dplyr) #for data processing
library(here) #to set paths
library(ggthemes)
library(RColorBrewer)
library(ggplot2)
library(table1)
library(tidymodels)

#Load data
data_spot1 <- here::here("data","processed_data","Finaldata.rds")

#load data 
FINALdta <- read_rds(data_spot1)
```
Creating Weekly Incidence Rate variable so we can compare across years
```{r}
FINALdta <- FINALdta %>% mutate(
  IR = Total * 1000/Estimated_population)
```
#WORK IN PROGRESS
> *Question for Dr. Handel*: I want to look at interaction between SOI, SST, Precip and ENSO (a combo of categorical, and continous).
What would be the best way to look at this statistically? Plot residuals?

# Data splitting
Here we are going to split the data randomly into training and testing subsets
- Training data will be used to fit the model. 75% of the model
- Testing set will be used to evaluate the model. 15% of data
```{r}
# Setting a seed for random number generation so if this analysis is reproduced, the same random set will be generated
set.seed(42) # the answer to life
# Subsetting 3/4 of data for the 2 categories
data_split <- initial_split(processeddta, prop = 3/4)
# Creating training data
train_data <- training(data_split)
# Creating testing data
test_data  <- testing(data_split)


# EDA Bivariate Analysis
## Weather Predictors vs. Dengue IR: GLM
Weather predictors are as follows:
  From station data
- MIN & MAT Air Temp (min) /// cont.
- Precipitation /// cont.
- Average Temp /// cont.
  From NOAA
- ENSO // categorical
- SOI /// cont.
- SST (region 3.4) /// cont.



## Looking at Station data predictors
```{r}
# Setting engine as LM because all are continous
glm_mod <- linear_reg() %>% 
  set_engine("glm")
# Setting recipe
# In EDA, I determined Min AT was best predictor, but we will throw in Max AT for fun
weather.rec<- recipe(IR ~ MinAT + MaxAT + Precip + TAvg, data = FINALdta)

weather.wflow <- 
  workflow() %>% 
  add_model(glm_mod) %>% 
  add_recipe(weather.rec)
nausea.wflow

#view summary of fit
tidy(lm_fit1)
```

# linear regression for one predictor, one outcome
```{r}
#predict particles per liter based on population
lm_fit2 <- lm_mod %>% fit(particles_l ~ population, data = data)
#view summary of fit
tidy(lm_fit2)
#predict particles per liter based on e coli
lm_fit3 <- lm_mod %>% fit(particles_l ~ e.coli.cfu, data = data)
#view summary of fit
tidy(lm_fit3)
#comparison of fit
comp2_3 <- anova(lm_fit2$fit, lm_fit3$fit, test = "Chisq")
comp2_





